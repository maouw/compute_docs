<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.525">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="The Apptainer container environment">

<title>UW Psychology - Apptainer</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../docs/compute/lmod.html" rel="next">
<link href="../../docs/compute/slurm.html" rel="prev">
<link href="../../_static/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/popover-glossary/popover-glossary.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="stylesheet" type="text/css" href="../../_static/asciicasts/asciinema-player.css">


</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/maouw/compute_docs">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/maouw/compute_docs/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/compute/index.html">Compute</a></li><li class="breadcrumb-item"><a href="../../docs/compute/apptainer.html">Apptainer</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../_static/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/start/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to UW Hyak</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/start/connect-ssh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Connecting to HYAK with SSH</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/start/hyakvnc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">hyakvnc</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/start/klone-storage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Storage on Klone</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/compute/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Compute</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/compute/slurm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SLURM Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/compute/apptainer.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Apptainer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/compute/lmod.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lmod</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/software/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Software</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/software/afni.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AFNI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/software/freesurfer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FreeSurfer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/software/matlab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MATLAB</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/software/spm_conn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SPM and CONN Toolboxes</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/storage/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Storage</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/compute/index.html">Compute</a></li><li class="breadcrumb-item"><a href="../../docs/compute/apptainer.html">Apptainer</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Apptainer</h1>
</div>

<div>
  <div class="description">
    The Apptainer container environment
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="apptainer" class="level1">
<h1>Apptainer</h1>
<p>Apptainer (formerly Singularity) is a simple container platform enabling users to install and run software that would otherwise be unsupported by the host environment.</p>
<p>On Klone, the <code>apptainer</code> command is available on all <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A node on the Klone cluster that is used for running jobs. See <a href="../../docs/compute/slurm.html">here</a> for more information.</p></div><a class="glossary-link" href="javascript:void(0);">compute nodes</a></button>, but it is not available on the <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A node on the Klone cluster that is used for logging in and
submitting jobs. See <a href="../../docs/compute/slurm.html">here</a> for more
information.</p></div><a class="glossary-link" href="javascript:void(0);">login node</a></button>.</p>
<p>By default, the <code>apptainer</code> command will use the system version of Apptainer:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> apptainer <span class="co"># prints /usr/bin/apptainer</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> <span class="at">--version</span> <span class="co"># apptainer version 1.2.4-1.el8 (as of 2023-12-05)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled" title="Loading a different version of Apptainer using Lmod">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Loading a different version of Apptainer using Lmod
</div>
</div>
<div class="callout-body-container callout-body">
<p>To use a different version of Apptainer, load the appropriate <a href="../../docs/compute/lmod.html"></a><button class="glossary-ref"><a href="../../docs/compute/lmod.html"></a><div class="glossary-def" role="tooltip"><a href="../../docs/compute/lmod.html"></a><p><a href="../../docs/compute/lmod.html">An environment module system that is used to load additional software
on Klone compute nodes. See </a><a href="../../docs/compute/lmod.html">here</a>
for more information.</p></div><a class="glossary-link" href="javascript:void(0);">Lmod</a></button> module. For example, to use Apptainer version 1.1.5:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load apptainer/1.1.5</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> apptainer <span class="co"># prints /sw/apptainer/1.1.5/bin/apptainer</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> <span class="at">--version</span> <span class="co"># apptainer version 1.1.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To see all available versions of Apptainer, run:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> <span class="at">-t</span> spider apptainer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The default module is indicated by the tag <code>(D)</code> following the version. For example, <code>apptainer/local (D)</code> indicates that the default version is <code>local</code>. (The local version is the version installed on the system.)</p>
</div>
</div>
<section id="using-apptainer" class="level2">
<h2 class="anchored" data-anchor-id="using-apptainer">Using Apptainer</h2>
<section id="interactive-session" class="level3">
<h3 class="anchored" data-anchor-id="interactive-session">Interactive session</h3>
<section id="bind-paths" class="level4">
<h4 class="anchored" data-anchor-id="bind-paths">Bind paths</h4>
<p><button class="glossary-ref"><div class="glossary-def" role="tooltip"></div><a class="glossary-link" href="javascript:void(0);">Apptainer</a></button> containers are designed to be portable, so by default they do not have access to any files on the host system. To make files available to the container, you must bind them to the container. This is done using the <code>--bind</code> option of the <code>apptainer</code> command or the <code>APPTAINER_BINDPATH</code> <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A variable that is used to store information about the environment
that a job is running in. See <a href="https://www.gnu.org/software/bash/manual/html_node/Environment.html">here</a>
for more information.</p></div><a class="glossary-link" href="javascript:void(0);">environment variable</a></button>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Default bind paths">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Default bind paths
</div>
</div>
<div class="callout-body-container callout-body">
<p>By default, <code>apptainer</code> will make several directories available within the container by binding them to the same path in the container, so that <code>/somefolder</code> on the host is available as <code>/somefolder</code> within the container.</p>
<p>These directories include: - <code>$HOME</code> (your home directory, a.k.a. <code>~</code>) - <code>/tmp</code> (temporary directory – unique to each node, contents are purged when the users’ last job running on the node completes) - <code>$PWD</code> (the current working directory, i.e.&nbsp;the directory you are in when you run <code>apptainer</code>)</p>
<p>The Klone Apptainer installation is also configured to bind several other following directories to the same path in the container, including:</p>
<ul>
<li><code>/mmfs1</code> (the main filesystem)</li>
<li><code>/scr</code> (the scratch filesystem, same as <code>/tmp</code>)</li>
</ul>
</div>
</div>
<p>We recommend setting the following binds before running a container:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">APPTAINER_BINDPATH</span><span class="op">=</span><span class="st">"/gscratch"</span> <span class="co"># Make /gscratch available within the container</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>To start an Apptainer container interactively, run the following:</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> shell <span class="op">&lt;</span>path_to_container<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="pulling-an-apptainer-image-from-docker.io-registry" class="level2">
<h2 class="anchored" data-anchor-id="pulling-an-apptainer-image-from-docker.io-registry">Pulling an Apptainer image from docker.io registry</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> pull docker://<span class="op">&lt;</span>image_name<span class="op">&gt;</span><span class="dt">\[</span>:<span class="op">&lt;</span>tag<span class="op">&gt;</span><span class="dt">\]</span> <span class="co"># Pulls the image from docker.io</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="writing-and-building-apptainer-recipes" class="level2">
<h2 class="anchored" data-anchor-id="writing-and-building-apptainer-recipes">Writing and building Apptainer recipes</h2>
<p>See the <a href="https://apptainer.org/docs/user/main/definition_files.html">Apptainer documentation</a>. <fixme></fixme></p>
</section>
<section id="usage-example" class="level2">
<h2 class="anchored" data-anchor-id="usage-example">Usage example</h2>
<section id="using-apptainer-to-run-a-python-script" class="level3">
<h3 class="anchored" data-anchor-id="using-apptainer-to-run-a-python-script">Using Apptainer to run a Python script</h3>
<p>Let’s try running a Python script using Apptainer. The <a href="https://docs.python.org/3/whatsnew/3.11.html#summary-release-highlights">release notes</a> for Python version 3.11 say that it is “between 10-60% faster than Python 3.10”. Is this true? Let’s find out! We’ll write a simple Python script to test this and use Apptainer to run it on Python 3.10 and Python 3.11.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>speedtest.py</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-5" data-filename="speedtest.py"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-5-1"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env python3</span></span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os, sys, timeit</span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the values of the environment variables M and N, or use default values:</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1">1</button><span id="annotated-cell-5-5" class="code-annotation-target"><a href="#annotated-cell-5-5" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> <span class="bu">int</span>(os.getenv(<span class="st">"M"</span>, default<span class="op">=</span><span class="dv">100</span>)) <span class="co"># inner loop iterations</span></span>
<span id="annotated-cell-5-6"><a href="#annotated-cell-5-6" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="bu">int</span>(os.getenv(<span class="st">"N"</span>, default<span class="op">=</span><span class="dv">1000</span>)) <span class="co"># outer loop iterations</span></span>
<span id="annotated-cell-5-7"><a href="#annotated-cell-5-7" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2">2</button><span id="annotated-cell-5-8" class="code-annotation-target"><a href="#annotated-cell-5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print details about the test to stderr:</span></span>
<span id="annotated-cell-5-9"><a href="#annotated-cell-5-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Python v</span><span class="sc">{</span>sys<span class="sc">.</span>version_info<span class="sc">.</span>major<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span>sys<span class="sc">.</span>version_info<span class="sc">.</span>minor<span class="sc">}</span><span class="ss">"</span>, <span class="bu">file</span><span class="op">=</span>sys.stderr)</span>
<span id="annotated-cell-5-10"><a href="#annotated-cell-5-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Running "-".join([str(n) for n in range(</span><span class="sc">{</span>M<span class="sc">}</span><span class="ss">)]) </span><span class="sc">{</span>N<span class="sc">}</span><span class="ss"> times'</span>, <span class="bu">file</span><span class="op">=</span>sys.stderr)</span>
<span id="annotated-cell-5-11"><a href="#annotated-cell-5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-5-12"><a href="#annotated-cell-5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the test:</span></span>
<span id="annotated-cell-5-13"><a href="#annotated-cell-5-13" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> timeit.timeit(<span class="kw">lambda</span>: <span class="st">"-"</span>.join([<span class="bu">str</span>(n) <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(M)]), number<span class="op">=</span>N)</span>
<span id="annotated-cell-5-14"><a href="#annotated-cell-5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-5-15"><a href="#annotated-cell-5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result:</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3">3</button><span id="annotated-cell-5-16" class="code-annotation-target"><a href="#annotated-cell-5-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="5,6" data-code-annotation="1">The <code>os.getenv</code> function retrieves the value of an <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A variable that is used to store information about the environment
that a job is running in. See <a href="https://www.gnu.org/software/bash/manual/html_node/Environment.html">here</a>
for more information.</p></div><a class="glossary-link" href="javascript:void(0);">environment variable</a></button> or returns a default value if the variable is not set.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="8,9,10" data-code-annotation="2">The <code>print</code> function prints to the <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>The standard error stream, <code>stderr</code>, is where a program’s
error and diagnostic messages are written to by default. See <a href="https://en.wikipedia.org/wiki/Standard_streams">here</a> for more
information.</p></div><a class="glossary-link" href="javascript:void(0);">standard error</a></button> stream (<code>stderr</code>) instead of the <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>The standard output stream, <code>stdout</code>, is where a program’s
output is written to by default. See <a href="https://en.wikipedia.org/wiki/Standard_streams">here</a> for more
information.</p></div><a class="glossary-link" href="javascript:void(0);">standard output</a></button> stream (<code>stdout</code>). This is useful because we want to print the result of the test to <code>stdout</code> so that we can save the output by redirecting it to a file, but we also want to print some information about the test to <code>stderr</code> so that it doesn’t get mixed up with the result.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="16" data-code-annotation="3">The <code>print</code> function prints to the <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>The standard output stream, <code>stdout</code>, is where a program’s
output is written to by default. See <a href="https://en.wikipedia.org/wiki/Standard_streams">here</a> for more
information.</p></div><a class="glossary-link" href="javascript:void(0);">standard output</a></button> stream (<code>stdout</code>) by default. We can redirect this to a file in <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A popular Unix shell and command language that is used on the Klone
cluster. See <a href="https://www.gnu.org/software/bash/">here</a> for
more information.</p></div><a class="glossary-link" href="javascript:void(0);">bash</a></button> using the <code>&gt;</code> operator.</span>
</dd>
</dl>
<p>Now let’s run the script using Python 3.10 and Python 3.11. For the image, we will use the <code>python:3.10-slim</code> and <code>python:3.11-slim</code> images from the official <a href="https://hub.docker.com/_/python">Python images</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Tagged container releases">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tagged container releases
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>python:3.10-slim</code> and <code>python:3.11-slim</code> images are tagged with the version of Python they contain. This means that if you pull the <code>python:3.10-slim</code> image today, it will always contain Python 3.10, even if Python 3.11 is released tomorrow.</p>
<p>The <code>python:*-slim</code> images are designed to contain only the minimal set of packages required to run Python and are therefore much smaller than the standard Python images (~45 MiB vs ~350 MiB).</p>
</div>
</div>
<p>We’ll use the <code>apptainer exec</code> command to run the script inside an Apptainer container:</p>
<div class="sourceCode" id="annotated-cell-6"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-1" class="code-annotation-target"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> exec docker://python:3.10-slim python3 speedtest.py</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="1" data-code-annotation="1">The <code>apptainer exec</code> command runs a command inside an Apptainer container. The <code>docker://python:3.10-slim</code> argument tells Apptainer to use the <code>python:3.10-slim</code> image from the Docker registry. The <code>python3 ./speedtest.py</code> argument tells Apptainer to run the <code>python3</code> command inside the container and provide it with the argument <code>speedtest.py</code>.</span>
</dd>
</dl>
<p>You should see something like:</p>
<div class="sourceCode" id="annotated-cell-7"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1">1</button><span id="annotated-cell-7-1" class="code-annotation-target"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Python</span> v3.10</span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> <span class="st">"-"</span>.join<span class="er">(</span><span class="ex">[str</span><span class="er">(</span><span class="ex">n</span><span class="kw">)</span> <span class="cf">for</span> n <span class="kw">in</span> range<span class="er">(</span><span class="ex">100</span><span class="kw">)</span><span class="ex">]</span><span class="kw">)</span> <span class="ex">1000</span> times</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2">2</button><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0.005480865002027713</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="1,2" data-code-annotation="1">This is printed to <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>The standard error stream, <code>stderr</code>, is where a program’s
error and diagnostic messages are written to by default. See <a href="https://en.wikipedia.org/wiki/Standard_streams">here</a> for more
information.</p></div><a class="glossary-link" href="javascript:void(0);">stderr</a></button> because we used <code>print(..., file=sys.stderr)</code> in the script.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="3" data-code-annotation="2">This is printed to <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>The standard output stream, <code>stdout</code>, is where a program’s
output is written to by default. See <a href="https://en.wikipedia.org/wiki/Standard_streams">here</a> for more
information.</p></div><a class="glossary-link" href="javascript:void(0);">stdout</a></button>.</span>
</dd>
</dl>
<p>It probably didn’t take very long to run the script. Let’s try running it again with larger values of <code>M</code> and <code>N</code>. We can set the values of <code>M</code> and <code>N</code> using <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A variable that is used to store information about the environment
that a job is running in. See <a href="https://www.gnu.org/software/bash/manual/html_node/Environment.html">here</a>
for more information.</p></div><a class="glossary-link" href="javascript:void(0);">environment variables</a></button>:</p>
<div class="sourceCode" id="annotated-cell-8"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1">1</button><span id="annotated-cell-8-1" class="code-annotation-target"><a href="#annotated-cell-8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">M</span><span class="op">=</span>1000 <span class="va">N</span><span class="op">=</span>100_000</span>
<span id="annotated-cell-8-2"><a href="#annotated-cell-8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> exec docker://python:3.10-slim python3 speedtest.py</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="1" data-code-annotation="1">The <code>export</code> command sets the values of the <code>M</code> and <code>N</code> <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A variable that is used to store information about the environment
that a job is running in. See <a href="https://www.gnu.org/software/bash/manual/html_node/Environment.html">here</a>
for more information.</p></div><a class="glossary-link" href="javascript:void(0);">environment variables</a></button> and makes them avaialble to other programs like <code>apptainer</code>. <code>N</code> is set to<code>100_000</code> instead of <code>100000</code> because underscores can be used in Python to make large numbers easier to read. This is a feature of Python, not the shell, which interprets <code>100_000</code> as just a string and not a number.</span>
</dd>
</dl>
<p>It should take a bit longer to run this time.</p>
<p>Now let’s try running the script using Python 3.11:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> exec docker://python:3.11-slim python3 speedtest.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We don’t need to set the values of <code>M</code> and <code>N</code> again because they are still set from the previous command via <code>export</code> (unless you closed your terminal window or logged out).</p>
<p>It probably took a bit less time to run the script this time.</p>
<p>Is Python 3.11 really faster than Python 3.10? Let’s find out by redirecting the output of the script to a file:</p>
<div class="sourceCode" id="annotated-cell-10"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1">1</button><span id="annotated-cell-10-1" class="code-annotation-target"><a href="#annotated-cell-10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> exec docker://python:3.10-slim python3 speedtest.py <span class="op">&gt;</span> py3.10.txt</span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> exec docker://python:3.11-slim python3 speedtest.py <span class="op">&gt;</span> py3.11.txt</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2">2</button><span id="annotated-cell-10-3" class="code-annotation-target"><a href="#annotated-cell-10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> py3.10.txt py3.11.txt <span class="co"># show the results</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="1,2" data-code-annotation="1">In <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A popular Unix shell and command language that is used on the Klone
cluster. See <a href="https://www.gnu.org/software/bash/">here</a> for
more information.</p></div><a class="glossary-link" href="javascript:void(0);">bash</a></button>, the <code>&gt;</code> operator redirects the output of a command to a file. If the file already exists, it will be overwritten. If you want to append to an existing file instead, use the <code>&gt;&gt;</code> operator. These operators can be used with any command, not just <code>apptainer</code>. For example, <code>ls &gt; my_files.txt</code> will write the output of <code>ls</code> to the file <code>my_files.txt</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="3" data-code-annotation="2">The <code>cat</code> command prints the contents of a file to <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>The standard output stream, <code>stdout</code>, is where a program’s
output is written to by default. See <a href="https://en.wikipedia.org/wiki/Standard_streams">here</a> for more
information.</p></div><a class="glossary-link" href="javascript:void(0);">stdout</a></button><code>If you want to print the contents of multiple files, you can list them all as arguments to</code>cat`.</span>
</dd>
</dl>
<p>We see the results, but they’re not very easy to interpret. Let’s pipe the output to Python to calculate the speedup:</p>
<div class="sourceCode" id="annotated-cell-11"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1">1</button><span id="annotated-cell-11-1" class="code-annotation-target"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> py3.10.txt py3.11.txt <span class="kw">|</span> <span class="ex">apptainer</span> exec docker://python:3.11-slim python3 <span class="at">-c</span> <span class="st">'print(float(input())/float(input()))'</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="1" data-code-annotation="1">The <code>|</code> operator pipes the output of one command to the input of another. In this case, we are piping the output of <code>cat py3.10.txt py3.11.txt</code> to the input of <code>apptainer exec docker://python:3.11-slim python3 -c 'print(float(input())/float(input()))'</code>. The <code>-c</code> option of the <code>python3</code> command tells Python to run the code provided as an argument. The code <code>print(float(input())/float(input()))</code> reads two lines of input from <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>The standard input stream, <code>stdin</code>, is where a program’s
input is read from by default. See <a href="https://en.wikipedia.org/wiki/Standard_streams">here</a> for more
information.</p></div><a class="glossary-link" href="javascript:void(0);">standard input</a></button>, converts them to floating point numbers, divides the first by the second, and prints the result.</span>
</dd>
</dl>
<p>In my case, Python 3.11 was about 1.3 times faster than Python 3.10. Not bad!</p>
<section id="demo" class="level4">
<h4 class="anchored" data-anchor-id="demo">Demo</h4>
<p>Here’s a demo of the above commands. Note that I used <code>M=200</code> and <code>N=50_000</code> instead of <code>M=1000</code> and <code>N=100_000</code> because it takes a long time to run the script with the larger values of <code>M</code> and <code>N</code>.</p>
<div id="apptainer-python-speedtest" class="cast">

</div>
</section>
</section>
</section>
<section id="clearing-apptainer-cache" class="level2">
<h2 class="anchored" data-anchor-id="clearing-apptainer-cache">Clearing Apptainer cache</h2>
<p>Apptainer caches all the images it downloads in a cache directory to avoid downloading them again. You can clear the cache by running:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> cache clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="changing-apptainer-cache" class="level2">
<h2 class="anchored" data-anchor-id="changing-apptainer-cache">Changing Apptainer cache</h2>
<p>You can change the cache directory by setting the <code>APPTAINER_CACHE</code> <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A variable that is used to store information about the environment
that a job is running in. See <a href="https://www.gnu.org/software/bash/manual/html_node/Environment.html">here</a>
for more information.</p></div><a class="glossary-link" href="javascript:void(0);">environment variable</a></button>. For example, to set the cache directory to <code>/tmp/&lt;your-username&gt;/apptainer-cache</code>, you can use the <code>$USER</code> environment variable:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">APPTAINER_CACHE</span><span class="op">=</span><span class="st">"/tmp/</span><span class="va">$USER</span><span class="st">/apptainer-cache"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Apptainer will create the cache directory if it does not already exist.</p>
<p>You’ll need to set the <code>APPTAINER_CACHE</code> <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A variable that is used to store information about the environment
that a job is running in. See <a href="https://www.gnu.org/software/bash/manual/html_node/Environment.html">here</a>
for more information.</p></div><a class="glossary-link" href="javascript:void(0);">environment variable</a></button> every time you want to use Apptainer, so it’s a good idea to add it to your <button class="glossary-ref"><div class="glossary-def" role="tooltip"><p>A file that contains commands that are run when a bash shell is
started. See <a href="https://www.gnu.org/software/bash/manual/html_node/Bash-Startup-Files.html">here</a>
for more information.</p></div><a class="glossary-link" href="javascript:void(0);">~/.bashrc</a></button> file so that it is set automatically when you log in.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../docs/compute/slurm.html" class="pagination-link  aria-label=" slurm="" basics"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">SLURM Basics</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../docs/compute/lmod.html" class="pagination-link" aria-label="Lmod">
        <span class="nav-page-text">Lmod</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script src="../../_static/asciicasts/asciinema-player.min.js"></script>
<script>
    term_font_family="'Iosevka Term Web', monospace'"
    document.querySelectorAll('.cast').forEach((block) => {
        AsciinemaPlayer.create("/_static/asciicasts/casts/" + block.id + ".cast", block, {
              terminalFontFamily: 'Iosevka Term Web, monospace',
               fit: false
        })
        });
</script>
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script>
  const refs = document.querySelectorAll(".glossary-ref");

  refs.forEach((ref) => {
    const link = ref.querySelector(".glossary-link");
    const def = ref.querySelector(".glossary-def");
    const popperInstance = Popper.createPopper(ref, def, {
      placement: "auto",
    });

    function show() {
      // Make the def visible
      def.setAttribute("data-show", "");

      // Enable the event listeners
      popperInstance.setOptions((options) => ({
        ...options,
        modifiers: [
          ...options.modifiers,
          { name: "eventListeners", enabled: true },
        ],
      }));

      // Update its position
      popperInstance.update();
    }

    function hide() {
      // Hide the def
      def.removeAttribute("data-show");

      // Disable the event listeners
      popperInstance.setOptions((options) => ({
        ...options,
        modifiers: [
          ...options.modifiers,
          { name: "eventListeners", enabled: false },
        ],
      }));
    }

    const showEvents = ["click"];
    const hideEvents = ["blur"];

    showEvents.forEach((event) => {
      link.addEventListener(event, show);
    });

    hideEvents.forEach((event) => {
      link.addEventListener(event, hide);
    });
  });
</script>




</body></html>